"use strict";(("undefined"!=typeof self?self:global).webpackChunkopen=("undefined"!=typeof self?self:global).webpackChunkopen||[]).push([[3780],{22578:(e,t,n)=>{n.d(t,{$:()=>p});n(26699),n(32023),n(69600),n(68309),n(21249);var r=n(67294),o=n(64593),u=n(96206),a=n(69691),c=n(8341),i=n(89952),s=n(51615),l=n(24183);function f(e){return e.includes("Spotify")?e:"Spotify – ".concat(e)}var p=function(e){var t,n,p,d,v,m,w,h=e.children,g=e.usePlayingItem,k=f(h);t=h,d=(0,l.Oh)().mainLandmarkRef,v=(0,s.k6)(),m=null===(n=v.location)||void 0===n||null===(p=n.state)||void 0===p?void 0:p.preventMoveFocus,(w=(0,r.useRef)(v.length<2)).current=v.length<2,(0,r.useEffect)((function(){var e=d.current;!m&&!w.current&&e&&t&&(e.setAttribute("aria-label",t),e.focus())}),[t,d,m]);var I=(0,a.IK)().isPlaying,b=(0,c.Y)((function(e){return null==e?void 0:e.item}));return b&&(I||g)&&((0,i.G_)(b)?k=[b.name,b.artists.map((function(e){return e.name})).join(u.ag.getSeparator())].join(" • "):(0,i.iw)(b)?k=[b.name,b.show.name].join(" • "):(0,i.k6)(b)&&(k=f(u.ag.get("ad-formats.advertisement")))),r.createElement(o.q,{defaultTitle:"Spotify",defer:!1},r.createElement("title",null,k))}},57345:(e,t,n)=>{n.r(t),n.d(t,{default:()=>y});var r=n(15861),o=n(29439),u=n(87757),a=n.n(u),c=(n(69600),n(21249),n(92222),n(67294)),i=n(94184),s=n.n(i),l=n(86706),f=n(51615),p=n(69518),d=n.n(p),v=n(96206),m=n(22578),w=n(6158),h=n(50709),g=n(67448),k=n(99125),I=n(23716),b=n(8341);function E(e,t){var n=(0,g.z)();(0,c.useEffect)((function(){var r=n.getEvents(),o=function(e){return t(e)};return r.addListener(e,o),function(){r.removeListener(e,o)}}),[e,n,t])}const j="_8NXEiIW8UUvsBVNhHdc";const y=c.memo((function(){var e=(0,f.UO)(),t=e.projectId,n=e.songId,u=(0,c.useRef)(null),i=(0,l.I0)(),p=(0,g.z)(),y=(0,f.k6)(),S=(0,c.useMemo)((function(){return[["showtippopups",0],["workflow","cover"],["workflowSongId",n]].map((function(e){var t=(0,o.Z)(e,2),n=t[0],r=t[1];return"".concat(n,"=").concat(r)})).join("&")}),[n]),x=(0,l.v9)((function(e){var t;return null===(t=e.session.user)||void 0===t?void 0:t.uri})),U=d().from(x).toURLPath(!0),L=(0,c.useState)(null),P=(0,o.Z)(L,2),Z=P[0],C=P[1],M=function(e){var t=e.redirectUri,n=(0,g.z)(),u=(0,c.useState)(""),i=(0,o.Z)(u,2),s=i[0],l=i[1],f=(0,c.useState)(null),p=(0,o.Z)(f,2),d=p[0],v=p[1];return(0,c.useEffect)((function(){(0,r.Z)(a().mark((function e(){var r,o;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.requestAccountLinkToken();case 3:r=e.sent,o=r.token,l("".concat("https://www.soundtrap.com/spotify/accountlink","/?redirect=").concat(encodeURIComponent(t),"&token=").concat(o)),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),v("Something went wrong while trying link your account");case 11:case"end":return e.stop()}}),e,null,[[0,8]])})))()}),[n,t]),{route:s,error:d}}({redirectUri:"https://www.soundtrap.com/studio/".concat(t,"/?").concat(S)}),R=M.route,_=M.error,O=(0,h.i)(),z=O.resetMainView,B=O.collapseMainView,N=(0,I.g)(),T=(0,b.Y)((function(e){return(null==e?void 0:e.hasContext)&&!(null!=e&&e.isPaused)}));(0,c.useEffect)((function(){var e=u.current;return p.setIframe(e),function(){p.setIframe(null)}}),[u,p,i]),E(k.O.EXIT,(function(){y.goBack()})),E(k.O.PUBLISH,function(){var e=(0,r.Z)(a().mark((function e(t){var n,r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.data,r=!n.title||!n.projectId,C(null),!r){e.next=6;break}return C("Cannot publish project, title or projectId are missing."),e.abrupt("return");case 6:return e.prev=6,e.next=9,p.publish({projectId:n.projectId,title:n.title});case 9:y.push(U,{referrer:"soundtrap_publish",newProjectId:n.projectId}),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(6),C("Something went wrong while trying to publish the project.");case 15:case"end":return e.stop()}}),e,null,[[6,12]])})));return function(t){return e.apply(this,arguments)}}()),(0,c.useEffect)((function(){T&&(null==N||N.pause())}),[T,N]),(0,c.useEffect)((function(){return B(),z}),[]);var V=null!=_?_:Z;return V?c.createElement(w.h,{hasError:!0,errorMessage:V}):c.createElement(c.Suspense,{fallback:null},c.createElement(m.$,null,v.ag.get("playlist.page-title")),c.createElement("iframe",{ref:u,src:R,className:s()(j),allow:"microphone https://www.soundtrap.com/studio;",title:"Soundtrap"}))}))}}]);
//# sourceMappingURL=xpui-routes-soundtrap-studio.js.map